# MoeTrip API 错误码说明

本文档详细说明 MoeTrip API 中使用的错误码及其含义。

## 错误码列表

### 成功状态
| 错误码 | 说明 | 示例场景 |
|--------|------|----------|
| 0 | 成功 | 请求成功完成 |

### 参数错误 (1000-1099)
| 错误码 | 说明 | 示例场景 |
|--------|------|----------|
| 1001 | 参数无效 | 页码小于1、日期格式错误、评分不在有效范围内、参数不完整 |
| 1002 | 名称重复/对象已存在 | 添加重复的景点名称、用户已对景点提交过反馈 |
| 1003 | 用户名已存在 | 注册时使用已存在的用户名 |
| 1004 | 用户名或密码错误 | 登录时提供错误的凭据 |
| 1005 | 票种余量不足 | 购票数量超过可用余量 |
| 1006 | 对象不存在 | 要操作的订单、景点、设施或反馈不存在 |
| 1007 | 操作不允许 | 尝试修改不属于自己的订单、反馈，或操作状态不允许的对象 |

### 权限错误 (2000-2099)
| 错误码 | 说明 | 示例场景 |
|--------|------|----------|
| 2001 | 权限不足 | 未登录用户尝试添加反馈、普通用户尝试修改他人反馈、普通用户尝试获取统计信息或访问管理功能 |
| 2002 | 令牌无效 | 提供了无效的JWT令牌或令牌已过期 |

### 系统错误 (5000-5099)
| 错误码 | 说明 | 示例场景 |
|--------|------|----------|
| 5000 | 服务器内部错误 | 数据库连接失败、未捕获的异常 |

## 错误响应格式

所有API错误响应都遵循以下格式：

```json
{
  "code": <错误码>,
  "message": "<错误描述>",
  "data": null
}
```

## 处理建议

1. **参数错误 (1000-1099)**
   - 检查请求参数的格式和值是否符合API规范
   - 对于重复项错误，尝试使用其他值
   - 对于余量不足错误，可尝试减少购票数量或选择其他日期

2. **权限错误 (2000-2099)**
   - 确认用户是否已登录，令牌是否有效
   - 确认用户是否有操作所需的角色（普通用户/管理员）
   - 对于无权限操作其他用户资源的情况，确认操作的对象是否属于当前用户

3. **系统错误 (5000-5099)**
   - 系统内部错误一般需要联系管理员
   - 可以尝试稍后重试请求

## 前端处理示例

```typescript
// API请求函数中处理错误码
async function apiRequest(endpoint, options) {
  try {
    const response = await fetch(endpoint, options);
    const data = await response.json();
    
    if (data.code !== 0) {
      // 处理特定错误码
      switch (data.code) {
        case 1001:
          // 显示参数错误
          showErrorMessage(data.message || "参数无效");
          break;
        case 2001:
        case 2002:
          // 权限错误，可能需要重新登录
          logout();
          router.push('/login');
          break;
        default:
          // 显示通用错误
          showErrorMessage(data.message || "请求失败");
      }
      return { success: false, error: data.message };
    }
    
    return { success: true, data: data.data };
  } catch (error) {
    // 网络错误或JSON解析错误
    return { success: false, error: "网络请求失败" };
  }
}
```

## 最佳实践

1. 始终检查响应中的 `code` 字段
2. 当 `code` 非0时，显示 `message` 中的错误信息
3. 对特定错误码实现特殊处理逻辑
